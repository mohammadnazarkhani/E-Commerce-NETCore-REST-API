# مستندات پایگاه داده

## نمای کلی

MockSmsProvider از یک پایگاه داده رابطه‌ای برای ذخیره اطلاعات کاربران، صندوق‌های ورودی و پیام‌های SMS استفاده می‌کند. این سند ساختار پایگاه داده و روابط بین موجودیت‌ها را توصیف می‌کند.

## نمودار رابطه موجودیت‌ها

![نمودار رابطه موجودیت‌ها](erd.drawio.svg)

## موجودیت‌ها

### کاربر (User)

- **شناسه** (string, PK): شماره تلفن یا نام شرکت که کاربر را شناسایی می‌کند
- **روابط**:
  - دارای یک صندوق ورودی (1:1)
  - دارای چندین پیام ارسالی (1:N با Sms)

### صندوق ورودی (Inbox)

- **شناسه** (GUID, PK): شناسه منحصر به فرد برای صندوق ورودی
- **شناسه کاربر** (string, FK): ارجاع به کاربر مالک
- **روابط**:
  - متعلق به یک کاربر (1:1)
  - شامل چندین پیام (1:N با Sms)

### پیامک (Sms)

- **شناسه** (GUID, PK): شناسه منحصر به فرد برای پیام
- **متن پیام** (string): محتوای پیامک
- **شناسه فرستنده** (string, FK): ارجاع به کاربر فرستنده پیام
- **شناسه صندوق ورودی** (GUID, FK): ارجاع به صندوق ورودی دریافت‌کننده
- **روابط**:
  - متعلق به یک کاربر فرستنده (N:1)
  - متعلق به یک صندوق ورودی دریافت‌کننده (N:1)

## نکات مهم

1. کاربران با شماره تلفن یا نام شرکت خود شناسایی می‌شوند (ذخیره شده در فیلد شناسه)
2. هر کاربر به طور خودکار یک صندوق ورودی دریافت می‌کند زمانی که اولین پیام را دریافت می‌کند
3. پیام‌ها در صندوق ورودی گیرنده ذخیره می‌شوند و به فرستنده لینک می‌شوند
4. پایگاه داده از پیام‌رسانی یک‌طرفه پشتیبانی می‌کند (بدون پاسخ مستقیم در مدل داده)

## نمونه کوئری‌ها

### دریافت پیام‌های صندوق ورودی کاربر

```sql
SELECT s.*
FROM Sms s
JOIN Inbox i ON s.InboxId = i.Id
WHERE i.UserId = @userId
ORDER BY s.Id DESC;
```

### دریافت پیام‌های ارسالی کاربر

```sql
SELECT s.*
FROM Sms s
WHERE s.SenderId = @userId
ORDER BY s.Id DESC;
```
